# Browsergame - Siedlungsaufbau Spiel

Ein webbasiertes Strategiespiel, bei dem Spieler ihre eigenen Siedlungen aufbauen und verwalten k√∂nnen. Baue Geb√§ude, sammle Ressourcen und erweitere deine Siedlung in diesem browserbasierten Aufbauspiel.

## üöÄ Quick Start

### Option 1: Docker (Empfohlen / Recommended) üê≥

Der einfachste Weg ist die Verwendung von Docker:

```bash
# Docker Quick Start
git clone https://github.com/chris738/browsergame.git
cd browsergame
./docker-start.sh
```

Das war's! Das Spiel l√§uft unter http://localhost:8080

### Option 2: Automatische Installation üîß

F√ºr Ubuntu/Debian/CentOS/RHEL Systeme:

```bash
git clone https://github.com/chris738/browsergame.git
cd browsergame
./install.sh
```

### Option 3: Manuelle Installation

```bash
# Ubuntu/Debian Quick Install
sudo apt update && sudo apt install apache2 php php-mysql mariadb-server git -y
sudo mysql_secure_installation
cd /var/www/html
sudo git clone https://github.com/chris738/browsergame.git game
sudo chown -R www-data:www-data /var/www/html/game

# Datenbank einrichten
mysql -u root -p < /var/www/html/game/database.sql

# Installation √ºberpr√ºfen
# Browser: http://localhost/game/installation-check.php
```

## üéÆ Spielfeatures

- **Siedlungsverwaltung**: Baue und upgrade verschiedene Geb√§ude
- **Ressourcensystem**: Sammle und verwalte Holz, Stein und Erz
- **Echtzeitproduktion**: Ressourcen werden automatisch √ºber die Zeit generiert
- **Bausystem**: Geb√§ude-Upgrades mit Warteschlange und Bauzeiten
- **Karte**: Siedlungen werden auf einer Koordinatenkarte platziert
- **Admin-Panel**: Vollst√§ndige Verwaltung von Spielern und Siedlungen

### Verf√ºgbare Geb√§ude
- **Holzf√§ller**: Produziert Holz
- **Steinbruch**: Produziert Stein  
- **Erzbergwerk**: Produziert Erz
- **Lager**: Erh√∂ht die Lagerkapazit√§t f√ºr Ressourcen
- **Farm**: Stellt Siedler f√ºr andere Geb√§ude bereit

## üîÑ Spiel zur√ºcksetzen / Game Reset

### Reset-Skripte / Reset Scripts

Das Spiel bietet verschiedene Reset-Optionen:

#### Kompletter Reset
```bash
# Interaktiv (mit Best√§tigung)
./reset.sh

# Automatisch (ohne Best√§tigung) - VORSICHT!
./reset.sh --force

# Hilfe anzeigen
./reset.sh --help
```

**Was wird zur√ºckgesetzt:**
- Alle Spieler und Siedlungen
- Alle Geb√§ude und Ressourcen
- Komplett Datenbank
- Docker-Container (bei Docker-Setup)
- Warteschlangen und Events

#### Nur Datenbank zur√ºcksetzen
```bash
# Interaktiv (mit Best√§tigung)
./reset-database.sh

# Automatisch (ohne Best√§tigung)
./reset-database.sh --force

# Hilfe anzeigen
./reset-database.sh --help
```

**Was wird zur√ºckgesetzt:**
- Alle Spieler und Siedlungen
- Alle Geb√§ude und Ressourcen
- Warteschlangen und Events

**Was bleibt erhalten:**
- Docker-Container (falls verwendet)
- Webserver-Konfiguration
- Dateiberechtigungen

#### Docker-integrierte Reset-Optionen
```bash
# √úber docker-start.sh
./docker-start.sh reset     # Kompletter Reset
./docker-start.sh reset-db  # Nur Datenbank
```

### ‚ö†Ô∏è Wichtige Hinweise

- **ALLE DATEN GEHEN VERLOREN** bei einem Reset
- Reset-Skripte erkennen automatisch Docker- oder manuelle Installation
- Nach dem Reset wird automatisch ein neuer Testspieler erstellt
- Backups werden **nicht** automatisch erstellt
- Nur f√ºr Entwicklungsumgebungen empfohlen

## üõ†Ô∏è Systemanforderungen

- **Webserver**: Apache 2.4+
- **PHP**: 7.4+ (empfohlen: 8.0+)
- **Datenbank**: MySQL 8.0+ oder MariaDB 10.4+
- **Browser**: Moderne Browser (Chrome, Firefox, Safari, Edge)

## üìã Installation

> **‚ö†Ô∏è Wichtiger Hinweis**: Diese Anleitung richtet nur eine Entwicklungsumgebung ein und ist **nicht f√ºr Produktivsysteme geeignet**!

### Ubuntu/Debian Installation

#### 1. Systemvorbereitung
```bash
# System aktualisieren
sudo apt update && sudo apt upgrade -y

# Ben√∂tigte Pakete installieren
sudo apt install apache2 php php-mysql mariadb-server git -y
```

#### 2. Webserver konfigurieren
```bash
# Apache-Module aktivieren
sudo a2enmod rewrite
sudo systemctl restart apache2

# PHP-Konfiguration √ºberpr√ºfen
php --version
```

#### 3. Datenbank einrichten
```bash
# MariaDB sichern und konfigurieren
sudo mysql_secure_installation
```

Bei der Konfiguration:
- Root-Passwort setzen (z.B. `root123`)
- Anonyme Benutzer entfernen: **Y**
- Root-Remote-Login deaktivieren: **Y**
- Test-Datenbank entfernen: **Y**
- Privilegien neu laden: **Y**

#### 4. Projekt installieren
```bash
# Projekt klonen
cd /var/www/html
sudo git clone https://github.com/chris738/browsergame.git game
sudo chown -R www-data:www-data /var/www/html/game
sudo chmod -R 755 /var/www/html/game
```

#### 5. Datenbank aufsetzen
```bash
# Mit MySQL/MariaDB verbinden
mysql -u root -p

# Datenbankskript ausf√ºhren (in MySQL-Konsole):
```

```sql
-- Skript aus database.sql ausf√ºhren
source /var/www/html/game/database.sql;

-- Ersten Spieler erstellen
CALL CreatePlayerWithSettlement('DeinSpielerName');

-- Verbindung beenden
exit;
```

#### 6. Datenbankverbindung konfigurieren
Falls andere Zugangsdaten gew√ºnscht sind, bearbeite die Datei `database.php`:
```php
private $host = 'localhost';
private $dbname = 'browsergame';
private $username = 'browsergame';  
private $password = 'sicheresPasswort';
```

### Windows (XAMPP) Installation

#### 1. XAMPP installieren
- Download von [xampp.org](https://www.apachefriends.org/)
- Apache und MySQL aktivieren

#### 2. Projekt einrichten
```batch
# Projekt nach xampp/htdocs kopieren
git clone https://github.com/chris738/browsergame.git C:\xampp\htdocs\game
```

#### 3. Datenbank einrichten
- phpMyAdmin √∂ffnen: `http://localhost/phpmyadmin`
- Neue Datenbank "browsergame" erstellen
- SQL-Datei `database.sql` importieren
- In SQL-Tab ausf√ºhren: `CALL CreatePlayerWithSettlement('DeinSpielerName');`

### Docker Installation (Alternative)

#### Voraussetzungen
- Docker 20.10+
- Docker Compose 2.0+

#### Schnellstart
```bash
# Repository klonen
git clone https://github.com/chris738/browsergame.git
cd browsergame

# Mit Docker starten
./docker-start.sh

# Oder manuell mit docker-compose
docker-compose up -d --build
```

#### Docker Befehle
```bash
# Stoppen
./docker-start.sh stop
# oder
docker-compose down

# Neustarten
./docker-start.sh restart

# Logs anzeigen
./docker-start.sh logs

# Status pr√ºfen
./docker-start.sh status

# Kompletter Reset (ALLE DATEN GEHEN VERLOREN!)
./docker-start.sh reset

# Nur Datenbank zur√ºcksetzen
./docker-start.sh reset-db

# Hilfe anzeigen
./docker-start.sh help
```

#### Zugriff
- **Spiel**: http://localhost:8080/
- **Admin Panel**: http://localhost:8080/admin.php
- **Installation Check**: http://localhost:8080/installation-check.php

#### Docker Konfiguration
Die Docker-Umgebung verwendet:
- **PHP 8.1** mit Apache
- **MariaDB 10.9**
- **Automatische Datenbankinitialisierung**
- **Vorkonfigurierter TestPlayer**

### Automatische Installation (Neu!)

F√ºr unterst√ºtzte Linux-Distributionen gibt es jetzt ein Installationsskript:

```bash
# Repository klonen
git clone https://github.com/chris738/browsergame.git
cd browsergame

# Automatische Installation starten
./install.sh
```

**Unterst√ºtzte Systeme:**
- Ubuntu 18.04+ / Debian 10+
- CentOS 7+ / RHEL 7+
- Rocky Linux / AlmaLinux

Das Script installiert automatisch:
- Apache Webserver
- PHP 8+ mit MySQL-Extension
- MariaDB Server
- Spiel-Dateien und Datenbank
- Erstellt initialen Admin-Spieler

### Manuelle Installation

## ‚úÖ Installation √ºberpr√ºfen

Nach der Installation kannst du mit diesem Script √ºberpr√ºfen, ob alles korrekt eingerichtet ist:

```
http://localhost/game/installation-check.php
```

Dieses Script √ºberpr√ºft:
- PHP-Version und Extensions
- Datenbankverbindung
- Dateiberechtigungen
- Verf√ºgbarkeit aller Komponenten

## üöÄ Verwendung

### Spiel starten
1. Browser √∂ffnen
2. Navigiere zu: `http://localhost/game/index.php?settlementId=1`
3. Beginne mit dem Aufbau deiner Siedlung!

### Admin-Panel
- URL: `http://localhost/game/admin.php`
- Standard-Zugangsdaten:
  - Benutzername: `admin`
  - Passwort: `admin123`

**Admin-Funktionen:**
- Spielerverwaltung (erstellen, bearbeiten, l√∂schen)
- Siedlungsressourcen verwalten
- Bauauftr√§ge √ºberwachen und verwalten
- Systemstatistiken einsehen

## üéØ Spielanleitung

1. **Ressourcen sammeln**: Deine Geb√§ude produzieren automatisch Ressourcen
2. **Geb√§ude upgraden**: Klicke auf "Upgrade" bei einem Geb√§ude
3. **Bauzeiten**: Upgrades dauern eine bestimmte Zeit und werden in der Warteschlange angezeigt
4. **Lagerkapazit√§t**: Vergiss nicht dein Lager zu erweitern!
5. **Siedler**: Die Farm bestimmt, wie viele Siedler verf√ºgbar sind

## üîß Konfiguration

### Umgebungsvariablen

Das Spiel unterst√ºtzt jetzt Umgebungsvariablen f√ºr die Datenbankkonfiguration:

```bash
# .env Datei erstellen (optional)
cp .env.example .env
```

**Verf√ºgbare Variablen:**
- `DB_HOST` - Datenbank Host (Standard: localhost)
- `DB_NAME` - Datenbankname (Standard: browsergame)
- `DB_USER` - Datenbankbenutzer (Standard: browsergame)
- `DB_PASSWORD` - Datenbankpasswort (Standard: sicheresPasswort)

### Datenbankverbindung √§ndern
**Docker:** Bearbeite `docker-compose.yml`
**Manuell:** Bearbeite `database.php` oder verwende Umgebungsvariablen
```php
private $host = 'dein-host';
private $dbname = 'dein-datenbankname';
private $username = 'dein-benutzer';
private $password = 'dein-passwort';
```

### Admin-Zugangsdaten √§ndern
In `admin.php` die Zeilen anpassen:
```php
// √Ñndere diese Werte f√ºr mehr Sicherheit
if ($username === 'admin' && $password === 'admin123') {
```

### Performance-Optimierung
F√ºr bessere Performance k√∂nnen folgende MySQL-Einstellungen angepasst werden:
```sql
-- Event-Scheduler optimieren
SET GLOBAL event_scheduler = ON;

-- Tabellen-Cache erh√∂hen (optional)
SET GLOBAL table_open_cache = 2048;
```

## üêõ Fehlerbehebung

### H√§ufige Probleme

#### "Database connection failed"
- √úberpr√ºfe MariaDB/MySQL-Status: `sudo systemctl status mariadb`
- Pr√ºfe Zugangsdaten in `database.php`
- Stelle sicher, dass die Datenbank "browsergame" existiert

#### "Permission denied" Fehler
```bash
sudo chown -R www-data:www-data /var/www/html/game
sudo chmod -R 755 /var/www/html/game
```

#### Apache startet nicht
```bash
# Apache-Fehlerlog pr√ºfen
sudo tail -f /var/log/apache2/error.log

# Apache neu starten
sudo systemctl restart apache2
```

#### Seite l√§dt nicht
- √úberpr√ºfe Apache-Status: `sudo systemctl status apache2`
- √úberpr√ºfe PHP-Installation: `php --version`
- Stelle sicher, dass mod_rewrite aktiviert ist: `sudo a2enmod rewrite`

#### MySQL-Event-Scheduler Probleme
```sql
-- Event-Scheduler aktivieren
SET GLOBAL event_scheduler = ON;

-- Events √ºberpr√ºfen
SHOW EVENTS;

-- Event-Scheduler Status pr√ºfen
SHOW VARIABLES LIKE 'event_scheduler';
```

**Wichtiger Hinweis:** Der Event-Scheduler ist essentiell f√ºr die automatische Ressourcenproduktion. Ohne ihn erh√∂hen sich die Ressourcen nicht automatisch. Das Spiel pr√ºft automatisch beim Start, ob der Event-Scheduler aktiviert ist, aber bei Problemen kann er manuell aktiviert werden:

```bash
# Automatisches Aktivierungsskript verwenden
./init-event-scheduler.sh

# Oder manuell als root:
mysql -u root -e "SET GLOBAL event_scheduler = ON;"
```

### Logs √ºberpr√ºfen
```bash
# Apache-Logs
sudo tail -f /var/log/apache2/access.log
sudo tail -f /var/log/apache2/error.log

# PHP-Logs
sudo tail -f /var/log/apache2/error.log | grep PHP
```

## üìÅ Projektstruktur

```
browsergame/
‚îú‚îÄ‚îÄ index.php              # Hauptspiel-Interface
‚îú‚îÄ‚îÄ backend.php            # API-Endpunkte f√ºr das Spiel
‚îú‚îÄ‚îÄ backend.js             # Frontend-JavaScript
‚îú‚îÄ‚îÄ style.css              # Haupt-Stylesheet
‚îú‚îÄ‚îÄ database.php           # Datenbankverbindung und -operationen
‚îú‚îÄ‚îÄ database.sql           # Datenbankschema und Initialdaten
‚îú‚îÄ‚îÄ installation-check.php # Installations√ºberpr√ºfung
‚îú‚îÄ‚îÄ admin.php              # Admin-Panel Interface
‚îú‚îÄ‚îÄ admin-backend.php      # Admin-API-Endpunkte
‚îú‚îÄ‚îÄ admin.js               # Admin-Panel JavaScript
‚îú‚îÄ‚îÄ admin.css              # Admin-Panel Stylesheet
‚îú‚îÄ‚îÄ map.php                # Kartenansicht
‚îî‚îÄ‚îÄ README.md              # Diese Datei
```

## üîí Sicherheitshinweise

> **‚ö†Ô∏è Nur f√ºr Entwicklungsumgebungen!**

F√ºr Produktivumgebungen **unbedingt** beachten:
- Standard-Passw√∂rter √§ndern
- HTTPS verwenden
- Firewall konfigurieren
- PHP-Sicherheitseinstellungen √ºberpr√ºfen
- Regelm√§√üige Updates
- Input-Validierung versch√§rfen
- Session-Sicherheit implementieren

## üìÑ Lizenz

Dieses Projekt steht unter einer Open-Source-Lizenz. Siehe Repository f√ºr Details.

## ü§ù Beitragen

Contributions sind willkommen! Erstelle gerne Issues oder Pull Requests.

## üìû Support

Bei Problemen oder Fragen erstelle ein Issue im GitHub-Repository.
